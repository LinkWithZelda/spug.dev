---
id: practice
title: 实践指南
---

### 安全性实践指南
写在前面，没有绝对的安全，如果环境允许的话尽量把 `Spug` 部署在内网且禁止公网访问，如果必须通过公网访问则尽可能通过防火墙等手段限制指定 IP 访问。

`Spug` 在登录安全方面提供了连续3次错误密码自动禁用账户的功能，尽可能的避免了被暴力破解登录的可能性。在 `Token` 安全方便提供了基于访问来源 IP 的
安全策略，当同一个 `Token` 访问来源 IP 发生变化时 `Token` 将自动失效，强制重新登录。
> `Token` 安全策略中的来源 IP 依赖 Nginx 转发请求时携带的 HTTP 头 `X-Real-IP`，所以请务必确保 `X-Real-IP` 为客户端的真实 IP 而不是上级的代
理 IP，如果你使用的推荐的 Docker 部署方式，则这些工作默认已经做好了，请不要在 Docker 容器暴露的 80 端口上再增加反向代理层。


### 发布过程中不同主机执行不同操作
假设一个应用需要发布到不同的三台主机上，但发布需要在主机上执行一些比如更新数据库等一次性且不能重复执行的操作，这时候可以考虑使用 `Spug` 的全局变量
`SPUG_HOST_ID` 或 `SPUG_HOST_NAME` 来指定只在某个主机上执行这些操作，例如：
```shell script
if [ "$SPUG_HOST_NAME" = "192.168.10.100" ];then
    echo "exec sql"
fi
```

### 默认PATH环境变量导致命令找不到问题
默认的 `PATH` 变量可能并不完整，这是因为 `Spug` 执行命令时并不是一个登录交互 `SHELL`，如果出现一些命令找不到等报错情况可以使用类似如下写法来解
决这个问题（注意以下写法并不会跨越不同的任务钩子，例如执行发布前执行的操作并不会影响发布执行后）：
```shell script
# 添加jdk至PATH变量
PATH=$PATH:/usr/local/jdk1.8.0_231/bin
java -jar xxx.jar
```

